サーバー点検システム レポート機能仕様書
1. 概要
本仕様書は、サーバー点検システムに追加するレポート機能に関する要件と実装方針を定義するものである。この機能により、顧客ごとの月次レポートや日次点検結果を体系的にPDF形式で出力し、承認ワークフローを通じて正式な点検記録として管理することが可能となる。
2. 目的
1.	顧客ごとの月次サーバー点検状況を可視化する
2.	日々の点検結果を記録として残す
3.	社内の承認ワークフローを電子化する
4.	点検業務の品質と信頼性を確保する
5.	点検記録の保管と参照を容易にする
3. レポート種別と基本仕様
3.1 月次顧客別レポート
項目	仕様
出力形式	PDF（A4サイズ、縦向き）
レポート単位	顧客ごと、月ごと
アクセス制限	顧客データは混在させない
言語	日本語
承認フロー	点検担当者 → 上長承認
印影表示	点検担当者印、承認者印
3.2 日次点検結果レポート
項目	仕様
出力形式	PDF（A4サイズ、縦向き）
レポート単位	顧客ごと、日ごと
生成タイミング	点検完了後（手動）
承認フロー	点検担当者 → 上長承認
印影表示	点検担当者印、承認者印
4. レポート内容
4.1 月次レポート内容
1.	ヘッダー部分
o	顧客名
o	レポート期間（年月）
o	レポート生成日時
o	会社ロゴ
2.	サマリーセクション
o	点検実施回数
o	点検実施率（予定に対する実績）
o	異常発生件数（サーバー別）
o	対応状況（対応済み/未対応）
o	月間稼働率
3.	サーバー別状況セクション
o	サーバーごとの稼働状況
o	異常検出履歴
o	図表によるステータス可視化
4.	詳細データセクション
o	日付別の点検結果一覧表
o	点検項目別の正常/異常状態
o	異常時のメモ/コメント
5.	署名欄
o	点検責任者署名（印影）
o	承認者署名（印影）
o	承認日時
4.2 日次レポート内容
1.	ヘッダー部分
o	顧客名
o	点検日
o	点検者名
o	点検時間（開始〜終了）
2.	点検結果概要
o	点検対象機器数
o	正常機器数
o	異常機器数
o	未点検機器数
3.	異常検出サーバー
o	異常があったサーバーのリスト
o	異常内容
o	発生した点検項目
o	対応状況と対応者
4.	詳細点検結果
o	サーバーごとの点検項目一覧
o	各項目の正常/異常状態
o	時系列での点検完了状況
5.	署名欄
o	点検実施者署名（印影）
o	承認者署名（印影）
o	承認日時
5. 承認ワークフロー
5.1 承認プロセスの流れ
1.	点検実施者による入力完了
o	点検作業の完了
o	レポート生成と承認申請
2.	上司による確認と承認
o	承認待ちレポートの確認
o	内容の確認後、承認または差し戻し
o	承認時にコメント追加（任意）
3.	承認完了と最終レポート生成
o	承認完了後、最終PDFレポートを生成
o	承認者の印影を自動付与
5.2 承認状態の管理
以下の承認状態を定義して管理する：
•	作成中 - 点検データ入力中
•	承認待ち - 点検完了、上司の承認待ち
•	承認済み - 上司の承認取得済み
•	差戻し - 修正必要項目あり（コメント付き）
•	完了 - 最終レポート生成済み
5.3 承認者の権限
•	承認者は自身が担当する顧客の点検レポートのみ承認可能
•	承認者は点検内容の詳細を閲覧可能
•	承認者は差し戻し時にコメントを付与可能
•	承認者は自身の印影を使用する権限を持つ
6. 印影管理機能
6.1 印影の登録と管理
•	管理者による印影画像のアップロード機能
•	ユーザーごとに印影を登録
•	印影の有効/無効管理
6.2 印影の仕様
•	画像形式：PNG（透過背景対応）
•	推奨サイズ：300 x 300 ピクセル以上
•	解像度：300dpi以上
•	ファイルサイズ：1MB以下
6.3 PDFへの印影適用
•	レポート署名欄に適切なサイズで印影を配置
•	点検者印と承認者印を明確に区別
•	印影と併せて署名者名と日時を記録
•	承認状態に応じた透かし表示（承認済/承認待ち）
6.4 印影のセキュリティ
•	印影画像へのアクセス権限を厳格に管理
•	印影使用ログを記録し、不正使用を防止
•	データベース内の印影パスは暗号化して保存
7. データベース設計
7.1 新規テーブル
report_templates（レポートテンプレート）テーブル
フィールド名	データ型	説明
id	INT	プライマリキー
name	VARCHAR(100)	テンプレート名
type	ENUM('monthly', 'daily')	レポートタイプ
template_path	VARCHAR(255)	テンプレートファイルパス
created_at	TIMESTAMP	作成日時
updated_at	TIMESTAMP	更新日時
generated_reports（生成済みレポート）テーブル
フィールド名	データ型	説明
id	INT	プライマリキー
customer_id	INT	顧客ID
report_date	DATE	レポート日付
report_period	VARCHAR(20)	レポート期間（年月または日付）
report_type	ENUM('monthly', 'daily')	レポートタイプ
file_path	VARCHAR(255)	生成されたPDFファイルパス
status	ENUM('draft', 'pending', 'approved', 'rejected', 'completed')	ステータス
template_id	INT	使用したテンプレートID
created_by	INT	作成者ID
created_at	TIMESTAMP	作成日時
report_approvals（レポート承認情報）テーブル
フィールド名	データ型	説明
id	INT	プライマリキー
report_id	INT	レポートID
requester_id	INT	申請者ID
approver_id	INT	承認者ID
status	ENUM('pending', 'approved', 'rejected')	承認状態
requested_at	TIMESTAMP	申請日時
approved_at	TIMESTAMP	承認日時
comment	TEXT	承認/差戻しコメント
approver_seal_id	INT	使用した印影ID
user_seals（ユーザー印影）テーブル
フィールド名	データ型	説明
id	INT	プライマリキー
user_id	INT	ユーザーID
seal_image_path	VARCHAR(255)	印影画像ファイルパス
seal_type	ENUM('personal', 'official')	印影タイプ
is_active	BOOLEAN	有効フラグ
created_at	TIMESTAMP	作成日時
updated_at	TIMESTAMP	更新日時
user_roles（ユーザー役割）テーブル
フィールド名	データ型	説明
id	INT	プライマリキー
user_id	INT	ユーザーID
role	ENUM('inspector', 'approver', 'admin')	役割
customer_id	INT	アクセス可能顧客ID（NULLの場合は全顧客）
7.2 テーブル間の関連
•	generated_reports -> customers: 1対多の関係（一つの顧客は複数のレポートを持つ）
•	generated_reports -> report_templates: 多対1の関係（複数のレポートは一つのテンプレートを使用）
•	report_approvals -> generated_reports: 多対1の関係（複数の承認は一つのレポートに対して行われる）
•	user_seals -> users: 多対1の関係（複数の印影は一人のユーザーに所属）
•	user_roles -> users: 多対1の関係（ユーザーは複数の役割を持つ）
•	user_roles -> customers: 多対1の関係（複数の役割は一つの顧客に関連付けられる）
8. 画面設計
8.1 レポート管理画面
目的: レポートの生成、閲覧、承認状態の確認を行う
主な機能:
•	レポート種別の選択（月次/日次）
•	顧客と期間の選択
•	レポート生成ボタン
•	生成済みレポート一覧表示
•	レポートの承認状態表示
画面要素:
•	レポート種別選択ラジオボタン
•	顧客選択ドロップダウン
•	期間選択（年月または日付）
•	レポート生成ボタン
•	レポート一覧テーブル（ID、顧客名、期間、状態、作成者、作成日時、アクション）
8.2 承認待ちレポート一覧画面
目的: 承認者が承認待ちのレポートを確認し、承認・差戻しを行う
主な機能:
•	承認待ちレポートの一覧表示
•	フィルタリング機能
•	レポート詳細表示
•	承認・差戻し機能
画面要素:
•	フィルター（顧客別/日付別/点検者別）
•	承認待ちレポート一覧テーブル
•	レポートプレビューボタン
•	承認ボタン
•	差戻しボタン（コメント入力欄付き）
8.3 印影管理画面
目的: ユーザーの印影を登録・管理する
主な機能:
•	印影のアップロード
•	印影のプレビュー
•	印影の有効/無効切り替え
•	印影使用ログの確認
画面要素:
•	ユーザー選択ドロップダウン
•	印影タイプ選択（個人印/角印）
•	ファイルアップロードボタン
•	印影プレビュー表示
•	印影情報表示（サイズ、更新日など）
•	有効/無効切り替えスイッチ
9. API設計
9.1 レポート管理API
エンドポイント	メソッド	説明	パラメータ
/api/reports/templates	GET	レポートテンプレート一覧取得	type: レポートタイプ
/api/reports/generate	POST	レポート生成リクエスト	customer_id, report_type, period
/api/reports/customers/:customerId	GET	顧客別レポート一覧取得	customerId, status, start_date, end_date
/api/reports/:reportId	GET	レポート詳細取得	reportId
/api/reports/download/:reportId	GET	レポートダウンロード	reportId, format
/api/reports/preview/:reportId	GET	レポートプレビューデータ取得	reportId
9.2 承認ワークフロー関連API
エンドポイント	メソッド	説明	パラメータ
/api/approvals/pending	GET	承認待ちレポート一覧取得	approver_id, customer_id
/api/approvals/:reportId/approve	POST	レポート承認	reportId, comment
/api/approvals/:reportId/reject	POST	レポート差戻し	reportId, comment, reason
/api/approvals/history	GET	承認履歴取得	user_id, start_date, end_date
9.3 印影管理API
エンドポイント	メソッド	説明	パラメータ
/api/seals/users/:userId	GET	ユーザーの印影一覧取得	userId
/api/seals/upload	POST	印影アップロード	user_id, seal_type, seal_image
/api/seals/:sealId/status	PUT	印影の有効/無効切り替え	sealId, is_active
/api/seals/usage-log	GET	印影使用ログ取得	user_id, seal_id, start_date, end_date
10. PDF生成仕様
10.1 使用ライブラリ
•	PDFKit（Node.js用PDFライブラリ）
•	Node-Canvas（画像処理）
10.2 PDFフォーマット
•	ページサイズ：A4
•	余白：上下25mm、左右20mm
•	フォント：IPAゴシック（日本語）、Arial（英数字）
•	解像度：300dpi
10.3 署名欄レイアウト
•	点検者情報
o	位置：ページ下部左側
o	内容：「点検実施者」ラベル、氏名、日時、印影
•	承認者情報
o	位置：ページ下部右側
o	内容：「承認者」ラベル、氏名、承認日時、印影
•	承認状態表示
o	位置：ページ中央（透かし）
o	内容：承認済み/承認待ち/差戻し
11. セキュリティ要件
11.1 データアクセス制御
•	顧客データの分離：異なる顧客のデータが混在しないよう制御
•	権限に基づくアクセス制御：ユーザーの役割に応じてデータアクセスを制限
•	監査ログ：重要な操作（レポート生成、承認、印影使用）のログを記録
11.2 印影セキュリティ
•	印影画像のアクセス制限：権限を持つユーザーのみがアクセス可能
•	印影の使用ログ：誰がいつどのレポートに印影を使用したかを記録
•	印影画像の保護：サーバー上の印影画像パスの暗号化
11.3 PDFセキュリティ
•	PDFの保護：生成されたPDFにパスワード保護を設定可能
•	透かし：承認状態を示す透かしの挿入
•	改ざん防止：将来的な電子署名導入への準備
12. 実装計画
12.1 フェーズ1：基本レポート機能（所要期間：4週間）
•	レポートテンプレート作成
•	基本PDF出力機能実装
•	データベーステーブル設計・実装
•	レポート生成画面の実装
12.2 フェーズ2：承認ワークフロー（所要期間：3週間）
•	承認プロセスのデータベース実装
•	承認/差戻し機能の実装
•	承認一覧画面の実装
•	承認状態に応じたレポート管理機能
12.3 フェーズ3：印影管理（所要期間：3週間）
•	印影データベースの実装
•	印影アップロード・管理機能の実装
•	PDFへの印影配置機能の実装
•	印影セキュリティ機能の実装
12.4 フェーズ4：テストと修正（所要期間：2週間）
•	結合テスト
•	ユーザー受け入れテスト
•	パフォーマンス最適化
•	問題点の修正
13. 将来の拡張予定
•	電子署名による承認プロセスの強化
•	複数段階承認ワークフロー
•	レポートテンプレートのカスタマイズ機能
•	権限管理の高度化
•	モバイル対応・承認機能
14. 用語集
用語	説明
月次レポート	月単位で作成される顧客別のサーバー点検結果報告書
日次レポート	日単位で作成される顧客別のサーバー点検結果報告書
承認者	レポートの内容を確認し承認権限を持つユーザー
点検者	サーバー点検を実施し結果を入力するユーザー
印影	ユーザーの署名を表す電子的な印鑑画像
承認ワークフロー	レポートが作成されてから承認されるまでの一連の流れ
15. 改訂履歴
版数	日付	改訂内容	担当者
1.0	2025/03/22	初版作成	システム管理者

